module: ComprehensiveExample
    import: std_io
    import: syscall.time
    
    // 结构体必须在globals之前定义
    struct: Animal
        fields:
            declare name: int
            declare age: int

        init:
            params:
                declare n: int
                declare a: int
            body:
                this.name = n
                this.age = a
            end body
        end init

        function: getName
            returns: int
            body:
                return this.name
            end body
        end function
        
        function: getAge
            returns: int
            body:
                return this.age
            end body
        end function
    end struct

    struct: Dog extends Animal
        fields:
            declare breed: int
        
        init:
            params:
                declare n: int
                declare a: int
                declare b: int
            body:
                super(n, a)
                this.breed = b
            end body
        end init

        function: getBreed
            returns: int
            body:
                return this.breed
            end body
        end function
        
        function: bark
            returns: string
            body:
                return "Woof! Woof!"
            end body
        end function
    end struct
    
    struct: Point
        fields:
            declare x: int
            declare y: int

        init:
            params:
                declare xVal: int
                declare yVal: int
            body:
                this.x = xVal
                this.y = yVal
            end body
        end init

        function: getX
            returns: int
            body:
                return this.x
            end body
        end function
        
        function: getY
            returns: int
            body:
                return this.y
            end body
        end function
        
        function: move
            params:
                declare dx: int
                declare dy: int
            returns: void
            body:
                this.x = this.x + dx
                this.y = this.y + dy
            end body
        end function
    end struct
    
    globals:
        declare globalCounter: int = 0
        declare _privateGlobal: string = "Private"
    
    function: main
        returns: void
        body:
            std_io.println("=== Comprehensive Snow Language Example ===")
            
            // 测试基本数据类型
            testBasicTypes()
            
            // 测试控制结构
            testControlStructures()
            
            // 测试函数
            testFunctions()
            
            // 测试结构体和继承
            testStructsAndInheritance()
            
            // 测试数组
            testArrays()
            
            // 测试系统调用
            testSyscalls()
            
            // 测试全局变量和访问控制
            testGlobalsAndAccessControl()
            
            std_io.println("=== All tests completed successfully! ===")
        end body
    end function
    
    function: testBasicTypes
        returns: void
        body:
            std_io.println("--- Testing Basic Types ---")
            declare b: byte = 127b
            declare s: short = 32767s
            declare i: int = 2147483647
            declare l: long = 9223372036854775807l
            declare f: float = 3.14159f
            declare d: double = 3.141592653589793
            declare bool: boolean = true
            declare str: string = "Hello Snow"
            
            std_io.println("byte: " + b)
            std_io.println("short: " + s)
            std_io.println("int: " + i)
            std_io.println("long: " + l)
            std_io.println("float: " + f)
            std_io.println("double: " + d)
            std_io.println("boolean: " + bool)
            std_io.println("string: " + str)
        end body
    end function
    
    function: testControlStructures
        returns: void
        body:
            std_io.println("--- Testing Control Structures ---")
            declare n: int = 10
            if n > 5 then
                std_io.println("n is greater than 5")
            else
                std_io.println("n is not greater than 5")
            end if
            
            std_io.println("Counting from 1 to 3:")
            loop:
                init:
                    declare i: int = 1
                cond:
                    i <= 3
                step:
                    i = i + 1
                body:
                    std_io.println("i = " + i)
                end body
            end loop
        end body
    end function
    
    function: add
        params:
            declare a: int
            declare b: int
        returns: int
        body:
            return a + b
        end body
    end function
    
    function: testFunctions
        returns: void
        body:
            std_io.println("--- Testing Functions ---")
            declare result: int = add(3, 5)
            std_io.println("3 + 5 = " + result)
        end body
    end function
    
    function: testStructsAndInheritance
        returns: void
        body:
            std_io.println("--- Testing Structs and Inheritance ---")
            
            // 测试Point结构体
            declare p: Point = new Point(10, 20)
            std_io.println("Point coordinates: (" + p.getX() + ", " + p.getY() + ")")
            p.move(5, -3)
            std_io.println("After move: (" + p.getX() + ", " + p.getY() + ")")
            
            // 测试继承
            declare dog: Dog = new Dog(1, 3, 2)
            std_io.println("Dog name: " + dog.getName())
            std_io.println("Dog age: " + dog.getAge())
            std_io.println("Dog breed: " + dog.getBreed())
            std_io.println("Dog says: " + dog.bark())
        end body
    end function
    
    function: testArrays
        returns: void
        body:
            std_io.println("--- Testing Arrays ---")
            
            // 一维数组
            declare arr: int[] = [1, 2, 3, 4, 5]
            std_io.println("First element: " + arr[0])
            std_io.println("Third element: " + arr[2])
            arr[0] = 10
            std_io.println("Modified first element: " + arr[0])
            
            // 手动管理数组长度
            declare arrLength: int = 5
            loop:
                init:
                    declare i: int = 0
                cond:
                    i < arrLength
                step:
                    i = i + 1
                body:
                    std_io.println("arr[" + i + "] = " + arr[i])
                end body
            end loop
            
            // 多维数组
            declare matrix: int[][] = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
            std_io.println("matrix[0][0]: " + matrix[0][0])
            std_io.println("matrix[1][2]: " + matrix[1][2])
            std_io.println("matrix[2][1]: " + matrix[2][1])
            matrix[0][0] = 10
            std_io.println("Modified matrix[0][0]: " + matrix[0][0])
        end body
    end function
    
    function: testSyscalls
        returns: void
        body:
            std_io.println("--- Testing Syscalls ---")
            declare startTime: long = time.mono_ms()
            std_io.println("Start time: " + startTime)
        end body
    end function
    
    function: testGlobalsAndAccessControl
        returns: void
        body:
            std_io.println("--- Testing Globals and Access Control ---")
            std_io.println("Global counter: " + globalCounter)
            globalCounter = globalCounter + 1
            std_io.println("Incremented global counter: " + globalCounter)
            
            // 访问公有成员
            std_io.println("Public function result: " + publicFunc())
        end body
    end function
    
    function: _privateFunction
        returns: string
        body:
            return "This is a private function"
        end body
    end function
    
    function: publicFunc
        returns: int
        body:
            return 42  // 简单返回一个值，避免使用不存在的.length属性
        end body
    end function
end module